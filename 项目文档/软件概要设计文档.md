# 智慧校园助手 - 软件概要设计文档

## 1. 系统架构设计

### 1.1 整体架构
本系统采用前后端分离的架构设计，具体如下：

```
+------------------+     +------------------+     +------------------+
|    前端应用      |     |    后端API       |     |    数据库        |
|  Vue 2 + Element | <-->| Django REST      | <-->|   SQLite         |
|      UI          |     |  Framework       |     |                  |
+------------------+     +------------------+     +------------------+
```

### 1.2 技术栈
- **前端**：Vue 2.x、Element UI、Axios
- **后端**：Django 3.x、Django REST Framework
- **数据库**：SQLite
- **认证**：JWT
- **通信**：HTTP/HTTPS

## 2. 模块划分

### 2.1 用户管理模块
- **功能**：用户注册、登录、信息管理、权限控制
- **核心组件**：
  - User模型
  - UserProfile模型
  - 认证视图和序列化器

### 2.2 二手交易模块
- **功能**：商品发布、浏览、交易、评价
- **核心组件**：
  - Product模型
  - Category模型
  - Transaction模型
  - ProductFavorite模型
  - ProductComment模型
  - TransactionReview模型

### 2.3 聊天模块
- **功能**：实时消息、对话管理
- **核心组件**：
  - Conversation模型
  - Message模型
  - 聊天视图和序列化器

### 2.4 餐饮订单模块
- **功能**：餐厅展示、菜品浏览、订单管理
- **核心组件**：
  - Restaurant模型
  - Dish模型
  - Order模型
  - DishReview模型

### 2.5 课程表模块
- **功能**：课程管理、课程表展示
- **核心组件**：
  - Course模型
  - Timetable模型

## 3. 核心业务流程

### 3.1 二手商品交易流程
1. 用户发布二手商品
2. 买家浏览商品，查看详情
3. 买家发起交易请求
4. 卖家确认交易
5. 交易完成，双方评价

### 3.2 聊天流程
1. 用户在商品详情页点击"联系卖家"
2. 系统创建对话（如果不存在）
3. 用户发送消息
4. 接收方收到消息通知
5. 接收方查看并回复消息

### 3.3 餐饮订单流程
1. 用户浏览餐厅和菜品
2. 添加菜品到购物车
3. 提交订单
4. 支付订单
5. 餐厅接单并准备餐品
6. 用户取餐
7. 用户评价菜品

## 4. 数据库设计

### 4.1 数据库表关系
- **用户与商品**：一对多关系，一个用户可发布多个商品
- **商品与分类**：多对一关系，多个商品属于一个分类
- **用户与收藏**：多对多关系，通过ProductFavorite表关联
- **商品与评论**：一对多关系，一个商品可有多条评论
- **商品与交易**：一对多关系，一个商品可有多笔交易
- **交易与评价**：一对多关系，一笔交易可有多条评价
- **用户与对话**：多对多关系，一个对话有两个参与者
- **对话与消息**：一对多关系，一个对话可有多条消息

## 5. 接口设计

### 5.1 API设计原则
- RESTful风格
- 统一的响应格式
- 错误处理机制
- 认证授权

### 5.2 主要接口类型
- **GET**：获取资源
- **POST**：创建资源
- **PUT**：更新资源
- **DELETE**：删除资源

## 6. 部署方案

### 6.1 开发环境
- 前端：Node.js + Vue CLI
- 后端：Python + Django
- 数据库：SQLite

### 6.2 生产环境
- 前端：Nginx静态文件服务
- 后端：uWSGI + Django
- 数据库：可扩展为MySQL或PostgreSQL
- 服务器：Linux服务器

## 7. 安全性设计

### 7.1 认证与授权
- JWT令牌认证
- 基于角色的权限控制
- API访问限制

### 7.2 数据安全
- 密码加密存储
- 敏感数据传输加密
- 防止SQL注入和XSS攻击

### 7.3 安全审计
- 操作日志记录
- 异常行为监测

## 8. 性能设计

### 8.1 前端性能优化
- 组件懒加载
- 图片优化
- 缓存机制

### 8.2 后端性能优化
- 数据库查询优化
- API缓存
- 异步处理

### 8.3 数据库性能优化
- 索引优化
- 查询优化
- 分表分库（可扩展）

## 9. 可扩展性设计

### 9.1 模块扩展
- 模块化设计，便于添加新功能
- 松耦合架构，模块间依赖度低

### 9.2 技术扩展
- 支持数据库切换
- 支持缓存机制扩展
- 支持消息队列集成

## 10. 测试设计

### 10.1 测试类型
- 单元测试
- 集成测试
- 系统测试
- 性能测试
- 安全测试

### 10.2 测试工具
- 前端：Jest、Vue Test Utils
- 后端：Django Test Framework、pytest
- API测试：Postman、curl

## 11. 维护设计

### 11.1 日志管理
- 系统日志
- 访问日志
- 错误日志

### 11.2 监控管理
- 系统监控
- 性能监控
- 异常监控

### 11.3 版本管理
- Git版本控制
- 语义化版本号
- 版本发布流程
